# 数据库设计文档

## 1. 数据库架构设计

### 1.1 多数据库架构
本系统采用多数据库架构，不同类型的数据存储到最适合的数据库中：

| 数据库 | 用途 | 主要数据类型 |
|--------|------|-------------|
| MySQL | 主数据库 | 用户、角色、菜单、部门等核心业务数据 |
| PostgreSQL | 扩展数据库 | 地理信息数据、向量数据 |
| MongoDB | 文档数据库 | 系统日志、AI对话历史、配置信息 |
| Redis | 缓存数据库 | 用户Session、JWT Token、系统缓存 |
| Elasticsearch | 搜索引擎 | 全文搜索、日志检索 |
| Milvus | 向量数据库 | AI模型向量、相似度搜索 |

### 1.2 数据库连接配置
```yaml
database:
  mysql:
    host: localhost
    port: 3306
    database: gin_admin
    username: root
    password: password
    charset: utf8mb4
    parseTime: true
    loc: Local
    maxIdleConns: 10
    maxOpenConns: 100
    connMaxLifetime: 3600
    
  postgresql:
    host: localhost
    port: 5432
    database: gin_admin_ext
    username: postgres
    password: password
    sslmode: disable
    maxIdleConns: 10
    maxOpenConns: 100
    extensions:
      - postgis
      - vector
      
  mongodb:
    uri: mongodb://localhost:27017
    database: gin_admin_docs
    timeout: 30s
    
  redis:
    host: localhost
    port: 6379
    password: ""
    database: 0
    poolSize: 100
    minIdleConns: 10
    
  elasticsearch:
    urls: ["http://localhost:9200"]
    username: ""
    password: ""
    
  milvus:
    host: localhost
    port: 19530
    database: gin_admin_vectors
```

## 2. MySQL 表设计（主数据库）

### 2.1 标准字段定义
所有业务表都包含以下标准审计字段：

```sql
-- 标准审计字段
id          BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
creator     VARCHAR(64)    DEFAULT '' COMMENT '创建者',
create_time DATETIME       DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
updater     VARCHAR(64)    DEFAULT '' COMMENT '更新者', 
update_time DATETIME       DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
deleted     BIT(1)         DEFAULT 0 COMMENT '是否删除：0未删除 1已删除',
tenant_id   BIGINT         DEFAULT 0 COMMENT '租户ID'
```

### 2.2 用户表 (system_users)
```sql
CREATE TABLE system_users (
    id          BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '用户ID',
    username    VARCHAR(30)    NOT NULL COMMENT '用户名',
    password    VARCHAR(100)   NOT NULL DEFAULT '' COMMENT '密码',
    nickname    VARCHAR(30)    NOT NULL COMMENT '昵称',
    remark      VARCHAR(500)            DEFAULT '' COMMENT '备注',
    dept_id     BIGINT                  DEFAULT 0 COMMENT '部门ID',
    post_ids    VARCHAR(255)            DEFAULT '' COMMENT '岗位ID列表',
    email       VARCHAR(50)             DEFAULT '' COMMENT '邮箱',
    mobile      VARCHAR(11)             DEFAULT '' COMMENT '手机号',
    sex         TINYINT                 DEFAULT 0 COMMENT '性别：0保密 1男 2女',
    avatar      VARCHAR(512)            DEFAULT '' COMMENT '头像地址',
    status      TINYINT       NOT NULL DEFAULT 0 COMMENT '状态：0启用 1禁用',
    login_ip    VARCHAR(50)             DEFAULT '' COMMENT '最后登录IP',
    login_date  DATETIME,
    -- 标准审计字段
    creator     VARCHAR(64)             DEFAULT '' COMMENT '创建者',
    create_time DATETIME               DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater     VARCHAR(64)             DEFAULT '' COMMENT '更新者',
    update_time DATETIME               DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted     BIT(1)                 DEFAULT 0 COMMENT '是否删除',
    tenant_id   BIGINT                 DEFAULT 0 COMMENT '租户ID',
    
    INDEX idx_username (username),
    INDEX idx_dept_id (dept_id),
    INDEX idx_mobile (mobile),
    INDEX idx_email (email),
    INDEX idx_status (status),
    INDEX idx_tenant_id (tenant_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

### 2.3 角色表 (system_role)
```sql
CREATE TABLE system_role (
    id          BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '角色ID',
    name        VARCHAR(30)    NOT NULL COMMENT '角色名称',
    code        VARCHAR(100)   NOT NULL COMMENT '角色编码',
    sort        INT                     DEFAULT 0 COMMENT '显示顺序',
    data_scope  TINYINT                 DEFAULT 1 COMMENT '数据权限：1全部 2自定义 3本部门 4本部门及下属',
    status      TINYINT       NOT NULL DEFAULT 0 COMMENT '状态：0启用 1禁用',
    type        TINYINT                 DEFAULT 2 COMMENT '类型：1系统角色 2自定义角色',
    remark      VARCHAR(500)            DEFAULT '' COMMENT '备注',
    -- 标准审计字段
    creator     VARCHAR(64)             DEFAULT '' COMMENT '创建者',
    create_time DATETIME               DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater     VARCHAR(64)             DEFAULT '' COMMENT '更新者',
    update_time DATETIME               DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted     BIT(1)                 DEFAULT 0 COMMENT '是否删除',
    tenant_id   BIGINT                 DEFAULT 0 COMMENT '租户ID',
    
    UNIQUE KEY uk_code (code),
    INDEX idx_name (name),
    INDEX idx_status (status),
    INDEX idx_type (type),
    INDEX idx_tenant_id (tenant_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色表';
```

### 2.4 菜单表 (system_menu)
```sql
CREATE TABLE system_menu (
    id          BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '菜单ID',
    name        VARCHAR(50)    NOT NULL COMMENT '菜单名称',
    permission  VARCHAR(100)           DEFAULT '' COMMENT '权限标识',
    type        TINYINT       NOT NULL COMMENT '菜单类型：1目录 2菜单 3按钮',
    sort        INT                     DEFAULT 0 COMMENT '显示顺序',
    parent_id   BIGINT                  DEFAULT 0 COMMENT '父菜单ID',
    path        VARCHAR(200)            DEFAULT '' COMMENT '路由地址',
    icon        VARCHAR(100)            DEFAULT '#' COMMENT '菜单图标',
    component   VARCHAR(255)            DEFAULT '' COMMENT '组件路径',
    status      TINYINT                 DEFAULT 0 COMMENT '状态：0启用 1禁用',
    visible     BIT(1)                 DEFAULT 1 COMMENT '是否显示：0隐藏 1显示',
    keep_alive  BIT(1)                 DEFAULT 1 COMMENT '是否缓存：0不缓存 1缓存',
    always_show BIT(1)                 DEFAULT 0 COMMENT '是否总是显示',
    -- 标准审计字段
    creator     VARCHAR(64)             DEFAULT '' COMMENT '创建者',
    create_time DATETIME               DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater     VARCHAR(64)             DEFAULT '' COMMENT '更新者',
    update_time DATETIME               DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted     BIT(1)                 DEFAULT 0 COMMENT '是否删除',
    tenant_id   BIGINT                 DEFAULT 0 COMMENT '租户ID',
    
    INDEX idx_parent_id (parent_id),
    INDEX idx_name (name),
    INDEX idx_type (type),
    INDEX idx_status (status),
    INDEX idx_tenant_id (tenant_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='菜单表';
```

### 2.5 部门表 (system_dept)
```sql
CREATE TABLE system_dept (
    id          BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '部门ID',
    name        VARCHAR(30)    NOT NULL COMMENT '部门名称',
    parent_id   BIGINT                  DEFAULT 0 COMMENT '父部门ID',
    sort        INT                     DEFAULT 0 COMMENT '显示顺序',
    leader_user_id BIGINT               DEFAULT 0 COMMENT '负责人用户ID',
    phone       VARCHAR(20)             DEFAULT '' COMMENT '联系电话',
    email       VARCHAR(50)             DEFAULT '' COMMENT '邮箱',
    status      TINYINT                 DEFAULT 0 COMMENT '状态：0启用 1禁用',
    -- 标准审计字段
    creator     VARCHAR(64)             DEFAULT '' COMMENT '创建者',
    create_time DATETIME               DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater     VARCHAR(64)             DEFAULT '' COMMENT '更新者',
    update_time DATETIME               DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted     BIT(1)                 DEFAULT 0 COMMENT '是否删除',
    tenant_id   BIGINT                 DEFAULT 0 COMMENT '租户ID',
    
    INDEX idx_parent_id (parent_id),
    INDEX idx_name (name),
    INDEX idx_status (status),
    INDEX idx_leader_user_id (leader_user_id),
    INDEX idx_tenant_id (tenant_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='部门表';
```

### 2.6 岗位表 (system_post)
```sql
CREATE TABLE system_post (
    id          BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '岗位ID',
    code        VARCHAR(64)    NOT NULL COMMENT '岗位编码',
    name        VARCHAR(50)    NOT NULL COMMENT '岗位名称',
    sort        INT                     DEFAULT 0 COMMENT '显示顺序',
    status      TINYINT                 DEFAULT 0 COMMENT '状态：0启用 1禁用',
    remark      VARCHAR(500)            DEFAULT '' COMMENT '备注',
    -- 标准审计字段
    creator     VARCHAR(64)             DEFAULT '' COMMENT '创建者',
    create_time DATETIME               DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater     VARCHAR(64)             DEFAULT '' COMMENT '更新者',
    update_time DATETIME               DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted     BIT(1)                 DEFAULT 0 COMMENT '是否删除',
    tenant_id   BIGINT                 DEFAULT 0 COMMENT '租户ID',
    
    UNIQUE KEY uk_code (code),
    INDEX idx_name (name),
    INDEX idx_status (status),
    INDEX idx_tenant_id (tenant_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='岗位表';
```

### 2.7 用户角色关联表 (system_user_role)
```sql
CREATE TABLE system_user_role (
    id          BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
    user_id     BIGINT         NOT NULL COMMENT '用户ID',
    role_id     BIGINT         NOT NULL COMMENT '角色ID',
    -- 标准审计字段
    creator     VARCHAR(64)             DEFAULT '' COMMENT '创建者',
    create_time DATETIME               DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater     VARCHAR(64)             DEFAULT '' COMMENT '更新者',
    update_time DATETIME               DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted     BIT(1)                 DEFAULT 0 COMMENT '是否删除',
    tenant_id   BIGINT                 DEFAULT 0 COMMENT '租户ID',
    
    UNIQUE KEY uk_user_role (user_id, role_id),
    INDEX idx_user_id (user_id),
    INDEX idx_role_id (role_id),
    INDEX idx_tenant_id (tenant_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户角色关联表';
```

### 2.8 角色菜单关联表 (system_role_menu)
```sql
CREATE TABLE system_role_menu (
    id          BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
    role_id     BIGINT         NOT NULL COMMENT '角色ID',
    menu_id     BIGINT         NOT NULL COMMENT '菜单ID',
    -- 标准审计字段
    creator     VARCHAR(64)             DEFAULT '' COMMENT '创建者',
    create_time DATETIME               DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater     VARCHAR(64)             DEFAULT '' COMMENT '更新者',
    update_time DATETIME               DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted     BIT(1)                 DEFAULT 0 COMMENT '是否删除',
    tenant_id   BIGINT                 DEFAULT 0 COMMENT '租户ID',
    
    UNIQUE KEY uk_role_menu (role_id, menu_id),
    INDEX idx_role_id (role_id),
    INDEX idx_menu_id (menu_id),
    INDEX idx_tenant_id (tenant_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色菜单关联表';
```

### 2.9 操作日志表 (system_operate_log)
```sql
CREATE TABLE system_operate_log (
    id          BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '日志ID',
    user_id     BIGINT                  DEFAULT 0 COMMENT '用户ID',
    username    VARCHAR(50)             DEFAULT '' COMMENT '用户名',
    trace_id    VARCHAR(64)             DEFAULT '' COMMENT '链路追踪ID',
    module_name VARCHAR(50)             DEFAULT '' COMMENT '模块名',
    business_type INT                  DEFAULT 0 COMMENT '业务类型',
    method      VARCHAR(100)            DEFAULT '' COMMENT '请求方法',
    request_url VARCHAR(255)            DEFAULT '' COMMENT '请求URL',
    user_agent  VARCHAR(500)            DEFAULT '' COMMENT '用户代理',
    request_ip  VARCHAR(50)             DEFAULT '' COMMENT '请求IP',
    request_params    TEXT COMMENT '请求参数',
    response_data     TEXT COMMENT '响应数据',
    operate_result  TINYINT               DEFAULT 0 COMMENT '操作结果：0成功 1失败',
    error_msg        VARCHAR(2000)       DEFAULT '' COMMENT '错误信息',
    operate_time DATETIME               DEFAULT CURRENT_TIMESTAMP COMMENT '操作时间',
    -- 标准审计字段
    creator     VARCHAR(64)             DEFAULT '' COMMENT '创建者',
    create_time DATETIME               DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater     VARCHAR(64)             DEFAULT '' COMMENT '更新者',
    update_time DATETIME               DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted     BIT(1)                 DEFAULT 0 COMMENT '是否删除',
    tenant_id   BIGINT                 DEFAULT 0 COMMENT '租户ID',
    
    INDEX idx_user_id (user_id),
    INDEX idx_username (username),
    INDEX idx_trace_id (trace_id),
    INDEX idx_operate_time (operate_time),
    INDEX idx_tenant_id (tenant_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='操作日志表';
```

### 2.10 登录日志表 (system_login_log)
```sql
CREATE TABLE system_login_log (
    id          BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '日志ID',
    user_id     BIGINT                  DEFAULT 0 COMMENT '用户ID',
    username    VARCHAR(50)             DEFAULT '' COMMENT '用户名',
    trace_id    VARCHAR(64)             DEFAULT '' COMMENT '链路追踪ID',
    login_type  TINYINT                 DEFAULT 0 COMMENT '登录类型：0用户名密码 1手机验证码 2第三方登录',
    login_result TINYINT                DEFAULT 0 COMMENT '登录结果：0成功 1失败',
    user_agent  VARCHAR(500)            DEFAULT '' COMMENT '用户代理',
    request_ip  VARCHAR(50)             DEFAULT '' COMMENT '请求IP',
    error_msg   VARCHAR(500)            DEFAULT '' COMMENT '错误信息',
    login_time  DATETIME               DEFAULT CURRENT_TIMESTAMP COMMENT '登录时间',
    -- 标准审计字段
    creator     VARCHAR(64)             DEFAULT '' COMMENT '创建者',
    create_time DATETIME               DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater     VARCHAR(64)             DEFAULT '' COMMENT '更新者',
    update_time DATETIME               DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted     BIT(1)                 DEFAULT 0 COMMENT '是否删除',
    tenant_id   BIGINT                 DEFAULT 0 COMMENT '租户ID',
    
    INDEX idx_user_id (user_id),
    INDEX idx_username (username),
    INDEX idx_login_time (login_time),
    INDEX idx_login_result (login_result),
    INDEX idx_tenant_id (tenant_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='登录日志表';
```

## 3. PostgreSQL 表设计（扩展数据库）

### 3.1 地理位置表 (geo_location)
```sql
-- 启用PostGIS扩展
CREATE EXTENSION IF NOT EXISTS postgis;

CREATE TABLE geo_location (
    id          BIGINT PRIMARY KEY,
    name        VARCHAR(100)   NOT NULL COMMENT '地点名称',
    address     VARCHAR(255)            DEFAULT '' COMMENT '详细地址',
    latitude    DECIMAL(10, 8)          COMMENT '纬度',
    longitude   DECIMAL(11, 8)          COMMENT '经度',
    geom        GEOMETRY(POINT, 4326)  COMMENT '地理坐标',
    level       TINYINT                 DEFAULT 0 COMMENT '级别：0国家 1省份 2城市 3区县',
    parent_id   BIGINT                  DEFAULT 0 COMMENT '父级ID',
    -- 标准审计字段
    creator     VARCHAR(64)             DEFAULT '' COMMENT '创建者',
    create_time TIMESTAMP              DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater     VARCHAR(64)             DEFAULT '' COMMENT '更新者',
    update_time TIMESTAMP              DEFAULT CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted     BOOLEAN                 DEFAULT FALSE COMMENT '是否删除',
    tenant_id   BIGINT                 DEFAULT 0 COMMENT '租户ID',
    
    INDEX idx_parent_id (parent_id),
    INDEX idx_name (name),
    INDEX idx_level (level),
    INDEX idx_tenant_id (tenant_id)
);

-- 创建空间索引
CREATE INDEX idx_geom ON geo_location USING GIST (geom);
```

### 3.2 向量存储表 (vector_store)
```sql
-- 启用vector扩展
CREATE EXTENSION IF NOT EXISTS vector;

CREATE TABLE vector_store (
    id          BIGINT PRIMARY KEY,
    name        VARCHAR(100)   NOT NULL COMMENT '向量名称',
    description TEXT                     COMMENT '描述',
    vector      VECTOR(1536)           COMMENT '向量数据（OpenAI embedding维度）',
    metadata    JSONB                  COMMENT '元数据',
    model_name  VARCHAR(50)            DEFAULT '' COMMENT '模型名称',
    -- 标准审计字段
    creator     VARCHAR(64)             DEFAULT '' COMMENT '创建者',
    create_time TIMESTAMP              DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater     VARCHAR(64)             DEFAULT '' COMMENT '更新者',
    update_time TIMESTAMP              DEFAULT CURRENT_TIMESTAMP COMMENT '更新时间',
    deleted     BOOLEAN                 DEFAULT FALSE COMMENT '是否删除',
    tenant_id   BIGINT                 DEFAULT 0 COMMENT '租户ID',
    
    INDEX idx_name (name),
    INDEX idx_model_name (model_name),
    INDEX idx_metadata USING GIN (metadata),
    INDEX idx_tenant_id (tenant_id)
);

-- 创建向量相似度索引（需根据具体需求调整）
CREATE INDEX idx_vector_cosine ON vector_store USING ivfflat (vector vector_cosine_ops) WITH (lists = 100);
```

## 4. MongoDB 文档设计（文档数据库）

### 4.1 系统日志集合 (system_logs)
```javascript
{
  _id: ObjectId,
  level: "INFO|WARN|ERROR",        // 日志级别
  message: "具体日志信息",           // 日志消息
  traceId: "链路追踪ID",            // 链路追踪ID
  userId: 12345,                    // 用户ID
  username: "admin",                // 用户名
  module: "system/user",            // 模块
  method: "POST /api/system/user/create", // 请求方法
  requestIp: "192.168.1.100",       // 请求IP
  userAgent: "Mozilla/5.0...",       // 用户代理
  requestParams: {                  // 请求参数
    username: "test",
    email: "test@example.com"
  },
  responseData: {                   // 响应数据
    code: 0,
    data: 1
  },
  costTime: 150,                    // 耗时（毫秒）
  createTime: ISODate("2024-01-01T12:00:00Z"),
  tenantId: 1
}

// 创建索引
db.system_logs.createIndex({ "createTime": -1 })
db.system_logs.createIndex({ "level": 1, "createTime": -1 })
db.system_logs.createIndex({ "userId": 1, "createTime": -1 })
db.system_logs.createIndex({ "traceId": 1 })
db.system_logs.createIndex({ "tenantId": 1 })
```

### 4.2 AI对话历史集合 (ai_conversations)
```javascript
{
  _id: ObjectId,
  conversationId: "conv_123456",     // 对话ID
  userId: 12345,                    // 用户ID
  sessionId: "session_789",         // 会话ID
  mode: "auto|manual|realtime",     // 对话模式
  messages: [                       // 消息列表
    {
      id: "msg_1",
      role: "user|assistant",       // 角色
      content: "你好",              // 消息内容
      audioUrl: "http://...",       // 音频URL（可选）
      timestamp: ISODate("2024-01-01T12:00:00Z"),
      metadata: {                   // 元数据
        model: "gpt-3.5-turbo",
        tokens: 10,
        cost: 0.001
      }
    }
  ],
  summary: "本次对话的主要内容总结",  // 对话摘要
  tags: ["客服", "咨询"],            // 标签
  status: "active|completed",       // 状态
  createTime: ISODate("2024-01-01T12:00:00Z"),
  updateTime: ISODate("2024-01-01T12:30:00Z"),
  tenantId: 1
}

// 创建索引
db.ai_conversations.createIndex({ "conversationId": 1 })
db.ai_conversations.createIndex({ "userId": 1, "createTime": -1 })
db.ai_conversations.createIndex({ "status": 1, "createTime": -1 })
db.ai_conversations.createIndex({ "tags": 1 })
db.ai_conversations.createIndex({ "tenantId": 1 })
```

### 4.3 配置信息集合 (system_configs)
```javascript
{
  _id: ObjectId,
  key: "system.site.title",         // 配置键
  value: "Gin管理系统",              // 配置值
  type: "string|number|boolean|json", // 值类型
  description: "系统标题",           // 描述
  group: "system",                  // 配置分组
  encrypted: false,                 // 是否加密
  visible: true,                    // 是否可见
  readonly: false,                  // 是否只读
  sortOrder: 1,                    // 排序
  options: [                        // 选项（用于枚举值）
    {
      label: "选项1",
      value: "value1"
    }
  ],
  creator: "admin",                 // 创建者
  createTime: ISODate("2024-01-01T12:00:00Z"),
  updater: "admin",                 // 更新者
  updateTime: ISODate("2024-01-01T12:00:00Z"),
  tenantId: 1
}

// 创建索引
db.system_configs.createIndex({ "key": 1 }, { unique: true })
db.system_configs.createIndex({ "group": 1 })
db.system_configs.createIndex({ "tenantId": 1 })
```

## 5. Redis 数据结构设计（缓存数据库）

### 5.1 JWT Token存储
```
Key: jwt:token:{userId}
Value: {
  "accessToken": "token_string",
  "refreshToken": "refresh_token_string", 
  "expiresTime": 1735689600,
  "loginIp": "192.168.1.100",
  "userAgent": "Mozilla/5.0..."
}
TTL: 7天（可配置）

Key: jwt:refresh:{refreshToken}
Value: {userId}
TTL: 30天（可配置）
```

### 5.2 用户权限缓存
```
Key: user:permission:{userId}
Value: ["system:user:list", "system:user:create", ...]
TTL: 30分钟

Key: user:menu:{userId}
Value: [
  {
    "id": 1,
    "name": "系统管理",
    "children": [...]
  }
]
TTL: 30分钟
```

### 5.3 系统缓存
```
Key: system:config:{group}
Value: {配置JSON数据}
TTL: 1小时

Key: system:dict:{type}
Value: {字典数据JSON}
TTL: 1小时
```

### 5.4 限流计数器
```
Key: rate:limit:{ip}:{endpoint}
Value: 访问次数
TTL: 1分钟

Key: rate:limit:user:{userId}:{endpoint}
Value: 用户访问次数
TTL: 1分钟
```

## 6. Elasticsearch 索引设计（搜索引擎）

### 6.1 系统日志索引 (system-logs)
```json
{
  "mappings": {
    "properties": {
      "level": { "type": "keyword" },
      "message": { "type": "text", "analyzer": "ik_max_word" },
      "traceId": { "type": "keyword" },
      "userId": { "type": "long" },
      "username": { "type": "keyword" },
      "module": { "type": "keyword" },
      "method": { "type": "keyword" },
      "requestIp": { "type": "ip" },
      "userAgent": { "type": "text" },
      "requestParams": { "type": "text" },
      "responseData": { "type": "text" },
      "costTime": { "type": "integer" },
      "createTime": { "type": "date" },
      "tenantId": { "type": "long" }
    }
  }
}

// 索引模板
{
  "index_patterns": ["system-logs-*"],
  "settings": {
    "number_of_shards": 3,
    "number_of_replicas": 1,
    "refresh_interval": "1s"
  },
  "mappings": { ... }
}
```

### 6.2 业务数据搜索索引 (business-data)
```json
{
  "mappings": {
    "properties": {
      "dataType": { "type": "keyword" },        // 数据类型：user, role, menu等
      "dataId": { "type": "long" },              // 数据ID
      "title": { "type": "text", "analyzer": "ik_max_word" },
      "content": { "type": "text", "analyzer": "ik_max_word" },
      "keywords": { "type": "keyword" },         // 关键词
      "tags": { "type": "keyword" },             // 标签
      "category": { "type": "keyword" },         // 分类
      "status": { "type": "keyword" },          // 状态
      "createTime": { "type": "date" },
      "updateTime": { "type": "date" },
      "tenantId": { "type": "long" }
    }
  }
}
```

## 7. Milvus 集合设计（向量数据库）

### 7.1 AI文本向量集合 (text_vectors)
```go
Collection: text_vectors
Fields:
- id: Int64 (主键)
- text: String (原始文本)
- vector: FloatVector (1536维，OpenAI embedding)
- model: String (模型名称，如 "text-embedding-ada-002")
- source: String (来源：document, conversation, query等)
- metadata: Map (元数据JSON)
- createTime: Int64 (创建时间戳)
- tenantId: Int64 (租户ID)

Index:
- vector: IVF_FLAT (cosine距离)
- tenantId: 标量索引
- createTime: 标量索引
- source: 标量索引
```

### 7.2 图像向量集合 (image_vectors)
```go
Collection: image_vectors
Fields:
- id: Int64 (主键)
- imageUrl: String (图像URL)
- vector: FloatVector (2048维，图像特征向量)
- model: String (模型名称，如 "clip-vit-base-patch32")
- tags: String[] (图像标签)
- description: String (图像描述)
- metadata: Map (元数据JSON)
- createTime: Int64 (创建时间戳)
- tenantId: Int64 (租户ID)

Index:
- vector: IVF_FLAT (cosine距离)
- tags: 标量索引
- tenantId: 标量索引
```

## 8. 数据库初始化脚本

### 8.1 MySQL初始化脚本
```sql
-- docs/sql/mysql/01_create_database.sql
CREATE DATABASE IF NOT EXISTS gin_admin 
CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

USE gin_admin;

-- 创建所有表（按依赖关系排序）
SOURCE docs/sql/mysql/02_system_users.sql;
SOURCE docs/sql/mysql/03_system_role.sql;
SOURCE docs/sql/mysql/04_system_menu.sql;
SOURCE docs/sql/mysql/05_system_dept.sql;
SOURCE docs/sql/mysql/06_system_post.sql;
SOURCE docs/sql/mysql/07_system_user_role.sql;
SOURCE docs/sql/mysql/08_system_role_menu.sql;
SOURCE docs/sql/mysql/09_system_operate_log.sql;
SOURCE docs/sql/mysql/10_system_login_log.sql;

-- 插入初始数据
SOURCE docs/sql/mysql/init_data.sql;
```

### 8.2 PostgreSQL初始化脚本
```sql
-- docs/sql/postgresql/01_create_database.sql
CREATE DATABASE gin_admin_ext;
\c gin_admin_ext;

-- 创建扩展
CREATE EXTENSION IF NOT EXISTS postgis;
CREATE EXTENSION IF NOT EXISTS vector;

-- 创建表
SOURCE docs/sql/postgresql/02_geo_location.sql;
SOURCE docs/sql/postgresql/03_vector_store.sql;
```

## 9. 数据库迁移策略

### 9.1 版本控制
使用数据库迁移工具管理数据库版本：
- MySQL: Flyway 或 GORM Migrate
- PostgreSQL: 同上
- MongoDB: mongo-migrate
- Elasticsearch: 版本化索引模板

### 9.2 数据同步
- 主从复制：MySQL、PostgreSQL
- 分片策略：按租户ID分片
- 缓存同步：Redis集群
- 搜索同步：Canal + Elasticsearch

### 9.3 备份策略
- 全量备份：每日凌晨
- 增量备份：每小时
- 日志备份：实时同步到备份中心
- 跨机房备份：异地容灾

## 10. 性能优化建议

### 10.1 索引优化
- 为常用查询字段创建索引
- 使用复合索引优化多字段查询
- 定期分析索引使用情况

### 10.2 查询优化
- 使用分页查询避免大结果集
- 合理使用缓存减少数据库访问
- 优化SQL语句，避免全表扫描

### 10.3 连接池优化
- 合理配置连接池大小
- 设置连接超时和空闲回收
- 监控连接池使用情况

### 10.4 分区表
- 对大表按时间分区
- 对历史数据进行归档
- 使用分区表提高查询性能