# 接口规范文档

## 1. 统一响应结构

### 1.1 基础响应格式
所有API接口必须使用统一的响应格式：

```json
{
  "code": 0,           // 状态码：0表示成功，非0表示错误
  "msg": "操作成功",    // 错误信息或成功提示
  "data": {}           // 响应数据，可为对象、数组或null
}
```

### 1.2 分页响应格式
分页查询接口使用专门的分页格式：

```json
{
  "code": 0,
  "msg": "操作成功",
  "data": {
    "total": 100,       // 总记录数
    "list": []          // 当前页数据列表
  }
}
```

### 1.3 状态码定义

| 状态码 | 说明 | HTTP状态码 |
|--------|------|------------|
| 0 | 操作成功 | 200 |
| 400 | 请求参数错误 | 400 |
| 401 | 未认证 | 401 |
| 403 | 无权限 | 403 |
| 404 | 资源不存在 | 404 |
| 500 | 服务器内部错误 | 500 |
| 1001 | 用户名或密码错误 | 400 |
| 1002 | 用户已被禁用 | 403 |
| 1003 | 角色已被禁用 | 403 |
| 1004 | Token已过期 | 401 |
| 1005 | Token无效 | 401 |
| 2001 | 用户名已存在 | 400 |
| 2002 | 角色名已存在 | 400 |
| 2003 | 菜单名称已存在 | 400 |
| 3001 | 数据权限不足 | 403 |

## 2. 通用请求规范

### 2.1 分页参数
所有分页查询接口都支持以下通用分页参数：

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| pageNo | int | 是 | 页码，从1开始 | 1 |
| pageSize | int | 是 | 每页数量，最大200 | 20 |

### 2.2 排序参数
支持通用排序参数：

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| sortField | string | 否 | 排序字段 | createTime |
| sortOrder | string | 否 | 排序方向：asc/desc | desc |

### 2.3 时间范围查询
支持时间范围查询：

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| createTime | string[] | 否 | 创建时间范围 | ["2024-01-01","2024-12-31"] |
| updateTime | string[] | 否 | 更新时间范围 | ["2024-01-01","2024-12-31"] |

## 3. 认证接口

### 3.1 用户登录
```
POST /api/system/auth/login
Content-Type: application/json

Request Body:
{
  "username": "admin",      // 用户名
  "password": "123456"      // 密码
}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",  // 访问令牌
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...", // 刷新令牌
    "expiresTime": 1735689600000  // 过期时间戳
  }
}
```

### 3.2 刷新令牌
```
POST /api/system/auth/refresh-token
Content-Type: application/json

Request Body:
{
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresTime": 1735689600000
  }
}
```

### 3.3 用户登出
```
POST /api/system/auth/logout
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": null
}
```

### 3.4 获取当前用户信息
```
GET /api/system/auth/get-permission-info
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": {
    "user": {
      "id": 1,
      "username": "admin",
      "nickname": "超级管理员",
      "email": "admin@example.com",
      "mobile": "13800138000",
      "avatar": "http://example.com/avatar.jpg",
      "status": 0,
      "createTime": "2024-01-01T00:00:00Z"
    },
    "roles": ["admin"],
    "permissions": ["system:user:list", "system:user:create", "system:user:update", "system:user:delete"],
    "menus": [
      {
        "id": 1,
        "name": "系统管理",
        "path": "/system",
        "component": "system/index",
        "icon": "system",
        "sort": 1,
        "children": [
          {
            "id": 2,
            "name": "用户管理",
            "path": "user",
            "component": "system/user/index",
            "icon": "user",
            "sort": 1
          }
        ]
      }
    ]
  }
}
```

## 4. 用户管理接口

### 4.1 用户分页查询
```
GET /api/system/user/page?pageNo=1&pageSize=20&username=admin&mobile=138&status=0&deptId=1&createTime=2024-01-01,2024-12-31
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": {
    "total": 100,
    "list": [
      {
        "id": 1,
        "username": "admin",
        "nickname": "超级管理员",
        "deptId": 1,
        "deptName": "总公司",
        "email": "admin@example.com",
        "mobile": "13800138000",
        "sex": 1,
        "avatar": "http://example.com/avatar.jpg",
        "status": 0,
        "loginIp": "192.168.1.100",
        "loginDate": "2024-01-01T12:00:00Z",
        "createTime": "2024-01-01T00:00:00Z"
      }
    ]
  }
}
```

### 4.2 获取用户详情
```
GET /api/system/user/get?id=1
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "username": "admin",
    "nickname": "超级管理员",
    "deptId": 1,
    "postIds": [1, 2],
    "email": "admin@example.com",
    "mobile": "13800138000",
    "sex": 1,
    "avatar": "http://example.com/avatar.jpg",
    "status": 0,
    "remark": "系统管理员"
  }
}
```

### 4.3 创建用户
```
POST /api/system/user/create
Content-Type: application/json
Authorization: Bearer {accessToken}

Request Body:
{
  "username": "testuser",        // 用户名，必填
  "nickname": "测试用户",         // 昵称，必填
  "password": "123456",          // 密码，必填
  "deptId": 1,                  // 部门ID，必填
  "postIds": [1, 2],            // 岗位ID列表，可选
  "email": "test@example.com",   // 邮箱，可选
  "mobile": "13800138001",       // 手机号，可选
  "sex": 1,                     // 性别：1男 2女，可选
  "avatar": "http://example.com/avatar.jpg", // 头像，可选
  "status": 0,                  // 状态：0启用 1禁用，必填
  "remark": "测试用户备注"       // 备注，可选
}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": 2  // 返回新创建的用户ID
}
```

### 4.4 更新用户
```
PUT /api/system/user/update
Content-Type: application/json
Authorization: Bearer {accessToken}

Request Body:
{
  "id": 2,                     // 用户ID，必填
  "nickname": "更新的测试用户",   // 昵称，可选
  "deptId": 2,                 // 部门ID，可选
  "postIds": [1],              // 岗位ID列表，可选
  "email": "updated@example.com", // 邮箱，可选
  "mobile": "13800138002",      // 手机号，可选
  "sex": 2,                    // 性别，可选
  "avatar": "http://example.com/new-avatar.jpg", // 头像，可选
  "status": 1,                 // 状态，可选
  "remark": "更新的备注"         // 备注，可选
}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": null
}
```

### 4.5 删除用户
```
DELETE /api/system/user/delete?id=2
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": null
}
```

### 4.6 批量删除用户
```
DELETE /api/system/user/delete-list
Content-Type: application/json
Authorization: Bearer {accessToken}

Request Body:
{
  "ids": [2, 3, 4]  // 用户ID列表
}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": null
}
```

### 4.7 导出用户
```
GET /api/system/user/export?username=admin&status=0
Authorization: Bearer {accessToken}

Response: Excel文件下载
```

### 4.8 获取用户简单列表
```
GET /api/system/user/simple-list?deptId=1
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "nickname": "超级管理员",
      "deptName": "总公司"
    }
  ]
}
```

### 4.9 重置用户密码
```
PUT /api/system/user/update-password
Content-Type: application/json
Authorization: Bearer {accessToken}

Request Body:
{
  "id": 2,              // 用户ID，必填
  "password": "123456"  // 新密码，必填
}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": null
}
```

### 4.10 修改用户状态
```
PUT /api/system/user/update-status
Content-Type: application/json
Authorization: Bearer {accessToken}

Request Body:
{
  "id": 2,      // 用户ID，必填
  "status": 1   // 状态：0启用 1禁用，必填
}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": null
}
```

## 5. 角色管理接口

### 5.1 角色分页查询
```
GET /api/system/role/page?pageNo=1&pageSize=20&name=管理员&code=admin&status=0&createTime=2024-01-01,2024-12-31
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": {
    "total": 50,
    "list": [
      {
        "id": 1,
        "name": "超级管理员",
        "code": "admin",
        "sort": 1,
        "dataScope": 1,  // 数据权限：1全部 2自定义 3本部门 4本部门及下属
        "status": 0,
        "type": 1,       // 类型：1系统角色 2自定义角色
        "remark": "系统超级管理员",
        "createTime": "2024-01-01T00:00:00Z"
      }
    ]
  }
}
```

### 5.2 获取角色详情
```
GET /api/system/role/get?id=1
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "name": "超级管理员",
    "code": "admin",
    "sort": 1,
    "dataScope": 1,
    "status": 0,
    "type": 1,
    "remark": "系统超级管理员"
  }
}
```

### 5.3 创建角色
```
POST /api/system/role/create
Content-Type: application/json
Authorization: Bearer {accessToken}

Request Body:
{
  "name": "测试角色",        // 角色名称，必填
  "code": "test",          // 角色编码，必填
  "sort": 2,               // 显示顺序，必填
  "dataScope": 2,          // 数据权限，必填
  "status": 0,             // 状态，必填
  "type": 2,               // 类型，必填
  "remark": "测试角色备注"   // 备注，可选
}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": 2  // 返回新创建的角色ID
}
```

### 5.4 更新角色
```
PUT /api/system/role/update
Content-Type: application/json
Authorization: Bearer {accessToken}

Request Body:
{
  "id": 2,
  "name": "更新的测试角色",
  "code": "test",
  "sort": 3,
  "dataScope": 3,
  "status": 1,
  "type": 2,
  "remark": "更新的备注"
}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": null
}
```

### 5.5 删除角色
```
DELETE /api/system/role/delete?id=2
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": null
}
```

### 5.6 获取角色简单列表
```
GET /api/system/role/list-all-simple
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "name": "超级管理员",
      "code": "admin"
    }
  ]
}
```

## 6. 菜单管理接口

### 6.1 获取菜单列表（树形结构）
```
GET /api/system/menu/list
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "name": "系统管理",
      "permission": "",
      "type": 1,         // 类型：1目录 2菜单 3按钮
      "sort": 1,
      "parentId": 0,
      "path": "/system",
      "icon": "system",
      "component": "system/index",
      "status": 0,
      "visible": true,
      "children": [
        {
          "id": 2,
          "name": "用户管理",
          "permission": "system:user:list",
          "type": 2,
          "sort": 1,
          "parentId": 1,
          "path": "user",
          "icon": "user",
          "component": "system/user/index",
          "status": 0,
          "visible": true
        }
      ]
    }
  ]
}
```

### 6.2 获取菜单详情
```
GET /api/system/menu/get?id=1
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "name": "系统管理",
    "permission": "",
    "type": 1,
    "sort": 1,
    "parentId": 0,
    "path": "/system",
    "icon": "system",
    "component": "system/index",
    "status": 0,
    "visible": true,
    "remark": "系统管理目录"
  }
}
```

### 6.3 创建菜单
```
POST /api/system/menu/create
Content-Type: application/json
Authorization: Bearer {accessToken}

Request Body:
{
  "name": "测试菜单",        // 菜单名称，必填
  "permission": "test:list", // 权限标识，可选
  "type": 2,              // 类型，必填
  "sort": 1,              // 显示顺序，必填
  "parentId": 1,           // 父菜单ID，必填
  "path": "test",         // 路由地址，可选
  "icon": "test",         // 菜单图标，可选
  "component": "test/index", // 组件路径，可选
  "status": 0,            // 状态，必填
  "visible": true,        // 是否可见，必填
  "remark": "测试菜单"     // 备注，可选
}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": 10  // 返回新创建的菜单ID
}
```

### 6.4 更新菜单
```
PUT /api/system/menu/update
Content-Type: application/json
Authorization: Bearer {accessToken}

Request Body:
{
  "id": 10,
  "name": "更新的测试菜单",
  "permission": "test:updated",
  "type": 2,
  "sort": 2,
  "parentId": 1,
  "path": "test-updated",
  "icon": "test-updated",
  "component": "test/updated",
  "status": 1,
  "visible": false,
  "remark": "更新的备注"
}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": null
}
```

### 6.5 删除菜单
```
DELETE /api/system/menu/delete?id=10
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": null
}
```

### 6.6 获取用户菜单权限
```
GET /api/system/permission/list-user-permissions
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "name": "系统管理",
      "path": "/system",
      "icon": "system",
      "children": [
        {
          "id": 2,
          "name": "用户管理",
          "path": "user",
          "icon": "user"
        }
      ]
    }
  ]
}
```

## 7. 部门管理接口

### 7.1 获取部门列表（树形结构）
```
GET /api/system/dept/list
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "name": "总公司",
      "parentId": 0,
      "sort": 1,
      "leaderUserId": 1,
      "phone": "010-12345678",
      "email": "company@example.com",
      "status": 0,
      "children": [
        {
          "id": 2,
          "name": "技术部",
          "parentId": 1,
          "sort": 1,
          "leaderUserId": 2,
          "phone": "010-12345679",
          "email": "tech@example.com",
          "status": 0
        }
      ]
    }
  ]
}
```

### 7.2 获取部门详情
```
GET /api/system/dept/get?id=1
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "name": "总公司",
    "parentId": 0,
    "sort": 1,
    "leaderUserId": 1,
    "phone": "010-12345678",
    "email": "company@example.com",
    "status": 0,
    "remark": "总公司"
  }
}
```

### 7.3 创建部门
```
POST /api/system/dept/create
Content-Type: application/json
Authorization: Bearer {accessToken}

Request Body:
{
  "name": "测试部门",        // 部门名称，必填
  "parentId": 1,           // 父部门ID，必填
  "sort": 1,               // 显示顺序，必填
  "leaderUserId": 1,       // 负责人用户ID，可选
  "phone": "010-12345678",  // 联系电话，可选
  "email": "test@example.com", // 邮箱，可选
  "status": 0,             // 状态，必填
  "remark": "测试部门"       // 备注，可选
}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": 5  // 返回新创建的部门ID
}
```

### 7.4 更新部门
```
PUT /api/system/dept/update
Content-Type: application/json
Authorization: Bearer {accessToken}

Request Body:
{
  "id": 5,
  "name": "更新的测试部门",
  "parentId": 2,
  "sort": 2,
  "leaderUserId": 2,
  "phone": "010-12345679",
  "email": "updated@example.com",
  "status": 1,
  "remark": "更新的备注"
}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": null
}
```

### 7.5 删除部门
```
DELETE /api/system/dept/delete?id=5
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": null
}
```

### 7.6 获取部门简单列表
```
GET /api/system/dept/simple-list
Authorization: Bearer {accessToken}

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "name": "总公司"
    },
    {
      "id": 2,
      "name": "技术部"
    }
  ]
}
```

## 8. 文件上传接口

### 8.1 文件上传
```
POST /api/infra/file/upload
Content-Type: multipart/form-data
Authorization: Bearer {accessToken}

Request Body:
file: [binary file data]  // 上传的文件

Response:
{
  "code": 0,
  "msg": "操作成功",
  "data": {
    "url": "http://example.com/files/abc123.jpg",  // 文件访问URL
    "fileName": "abc123.jpg",                     // 文件名
    "fileSize": 1024000,                          // 文件大小（字节）
    "contentType": "image/jpeg"                   // 文件类型
  }
}
```

## 9. 错误处理规范

### 9.1 参数验证错误
```json
{
  "code": 400,
  "msg": "请求参数错误：用户名不能为空",
  "data": null
}
```

### 9.2 业务逻辑错误
```json
{
  "code": 2001,
  "msg": "用户名已存在",
  "data": null
}
```

### 9.3 系统错误
```json
{
  "code": 500,
  "msg": "服务器内部错误，请稍后重试",
  "data": null
}
```

## 10. 请求头规范

### 10.1 认证请求头
```
Authorization: Bearer {accessToken}
```

### 10.2 内容类型
```
Content-Type: application/json  // JSON请求
Content-Type: multipart/form-data  // 文件上传
Content-Type: application/x-www-form-urlencoded  // 表单请求
```

### 10.3 接受格式
```
Accept: application/json  // 接受JSON响应
```

## 11. 版本控制规范

### 11.1 URL版本控制
```
/api/v1/system/user/page  // v1版本
/api/v2/system/user/page  // v2版本
```

### 11.2 请求头版本控制
```
API-Version: v1
```

## 12. 安全规范

### 12.1 HTTPS要求
生产环境所有API必须通过HTTPS访问。

### 12.2 请求签名（可选）
对敏感接口可增加请求签名验证。

### 12.3 限流规范
对API调用进行频率限制，防止滥用。

### 12.4 敏感数据处理
密码等敏感数据在传输和存储时必须加密。